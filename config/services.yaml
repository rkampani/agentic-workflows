# Agentic Performance Testing Platform — Service Registry
#
# Endpoint filtering:
#   include_endpoints → ONLY these endpoints are tested
#   exclude_endpoints → these endpoints are SKIPPED
#   Patterns: "GET /api/orders*", "POST *", "*/admin/*"
#
# Test data (like JMeter CSV Data Set Config):
#   test_data_file → JSON file with array of rows
#   Each VU gets a different row (round-robin across 500 users)
#   Row fields replace {placeholders} in paths and provide auth/body data
#
#   Example row: {"user_id": "1", "token": "Bearer ...", "body_analyze": {...}}
#   → GET /api/v1/users/{user_id}/history  becomes  /api/v1/users/1/history
#   → Authorization header gets "Bearer ..."
#   → POST /api/v1/analyze body gets body_analyze value
#
#   Field naming conventions:
#     path params:  user_id, meal_id, order_id  → replaces {user_id} etc.
#     auth token:   token                       → sent as Authorization header
#     request body: body_<endpoint_name>        → used for POST/PUT to that endpoint
#     headers:      header_<name>               → sent as custom header

services:
  bitewise-service:
    description: "Bitewise tracking, meal analysis, user health dashboard"
    team: "health"
    framework: "fastapi"
    swagger_path: "/openapi.json"
    environments:
      local: "http://localhost:8000"
      staging: "http://localhost:8000"
    test_data_file: "test-data/bitewise-service.json"
    include_endpoints:
      - "GET /api/v1/users/{user_id}"
    exclude_endpoints:
      - "GET /health"
      - "*/cache/*"
      - "*/debug/*"
      - "DELETE *"
      - "*/deactivate"
      - "*/data"
      - "*/export*"
      - "*/import*"
      - "/metrics*"
    max_concurrent_users: 10
    max_duration_seconds: 30

  recommendation-engine:
    description: "ML-powered product recommendations"
    team: "data"
    framework: "fastapi"
    swagger_path: "/openapi.json"
    environments:
      local: "http://localhost:8000"
      staging: "http://localhost:8000"

  auth-service:
    description: "Authentication, OAuth, JWT management"
    team: "platform"
    framework: "flask"
    swagger_path: "/swagger.json"
    environments:
      local: "http://localhost:5000"
      staging: "http://localhost:5000"
    exclude_endpoints:
      - "*/admin/*"
      - "DELETE *"

  notification-service:
    description: "Email, SMS, and push notifications"
    team: "platform"
    framework: "express"
    swagger_path: "/api-docs.json"
    environments:
      local: "http://localhost:3000"
      staging: "http://localhost:3000"
    exclude_endpoints:
      - "POST /api/notifications/send*"

  user-service:
    description: "User management, profiles"
    team: "platform"
    framework: "spring-boot"
    swagger_path: "/v3/api-docs"
    environments:
      local: "http://localhost:8083"
      staging: "http://localhost:8083"

# Safety settings
defaults:
  max_concurrent_users: 500
  max_duration_seconds: 600
  allowed_environments:
    - local
    - dev
    - staging
